<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok Live Analytics</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <span>üìä</span> TikTokAnalytics
    </div>
    <nav class="nav-links">
      <div class="nav-item active" data-tab="overview">Overview</div>
      <div class="nav-item" data-tab="rankings">Rankings</div>
      <div class="nav-item" data-tab="user-activity">User Activity</div>
      <div class="nav-item" data-tab="sessions">Sessions & Time</div>
      <div class="nav-item" data-tab="insights">Insights</div>
    </nav>
    <button id="refresh" class="primary-btn">Refresh Data</button>
    <div class="auto-refresh-toggle">
      <label class="toggle-switch">
        <input type="checkbox" id="autoRefreshToggle">
        <span class="toggle-slider"></span>
      </label>
      <span class="toggle-label">Auto-refresh</span>
    </div>
    <div class="data-management">
      <button id="exportMarks" class="secondary-btn small" title="Export VIP & Delete lists">Export</button>
      <button id="importMarks" class="secondary-btn small" title="Import VIP & Delete lists">Import</button>
      <input type="file" id="importFile" accept=".json" style="display: none;">
    </div>
    <div class="timezone-setting">
      <label class="setting-label">Timezone</label>
      <select id="timezoneSelect" class="setting-select">
        <option value="America/New_York">EST (New York)</option>
        <option value="America/Chicago">CST (Chicago)</option>
        <option value="America/Denver">MST (Denver)</option>
        <option value="America/Los_Angeles">PST (Los Angeles)</option>
        <option value="UTC">UTC</option>
        <option value="Europe/London">GMT (London)</option>
        <option value="Europe/Paris">CET (Paris)</option>
        <option value="Asia/Tokyo">JST (Tokyo)</option>
        <option value="Asia/Shanghai">CST (Shanghai)</option>
        <option value="Australia/Sydney">AEST (Sydney)</option>
      </select>
    </div>
    <div class="sidebar-footer">
      <span id="lastUpdated" class="text-muted">Last updated: -</span>
      <span id="totalRecords" class="text-muted">Records: 0</span>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">

    <!-- Persistent Top Bar -->
    <div class="header">
      <h2 id="pageTitle">Overview</h2>
      <div class="controls">
        <label>Period:</label>
        <select id="timeframeSelect">
          <option value="all">All Time</option>
          <option value="day" selected>Day</option>
          <option value="week">Week</option>
          <option value="month">Month</option>
        </select>
        <input type="date" id="datePicker" class="date-picker">
      </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <span>Loading data...</span>
      </div>
    </div>

    <!-- No Data Overlay -->
    <div id="noDataOverlay" class="no-data-overlay" style="display: none;">
      <div class="no-data-content">
        <div class="no-data-icon">üì≠</div>
        <h3>No Data Available</h3>
        <p id="noDataMessage">No records found for the selected period.</p>
      </div>
    </div>

    <!-- ==================== TAB 1: OVERVIEW ==================== -->
    <div id="tab-overview" class="tab-content active">

      <!-- Now Online & Ghost Sections -->
      <section class="live-status-grid two-col">
        <div class="card live-status-panel now-online">
          <div class="panel-header">
            <span><span class="status-dot online"></span> Now Online</span>
            <button class="view-marks-btn" id="viewMarksBtn" title="View VIP & Delete lists">
              View VIP/Delete <span class="marks-count-badge" id="marksCountBadge">0</span>
            </button>
          </div>
          <ul id="now-online-list" class="live-status-list"></ul>
        </div>
        <div class="card live-status-panel ghost">
          <div class="panel-header"><span class="status-dot ghost"></span> Ghost</div>
          <ul id="ghost-list" class="live-status-list"></ul>
        </div>
      </section>

      <!-- VIP/Delete Modal -->
      <div id="marksModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>VIP & Delete Lists</h3>
            <button class="modal-close-btn" id="closeMarksModal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="marks-section">
              <div class="marks-section-header">
                <span>üëÅÔ∏è VIP Users <span class="count-badge" id="vip-count">0</span></span>
                <button class="clear-all-btn" id="clear-all-vip">Clear All</button>
              </div>
              <ul id="vip-list" class="marks-list"></ul>
            </div>
            <div class="marks-section">
              <div class="marks-section-header">
                <span>‚ùå To Delete <span class="count-badge" id="to-delete-count">0</span></span>
                <button class="clear-all-btn" id="clear-all-delete">Clear All</button>
              </div>
              <ul id="to-delete-list" class="marks-list"></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- KPI Cards -->
      <section class="kpi-grid">
        <div class="card kpi-card">
          <span class="kpi-title">Total Connected Minutes</span>
          <span class="kpi-value" id="kpi-total-minutes">-</span>
        </div>
        <div class="card kpi-card">
          <span class="kpi-title">Total Sessions</span>
          <span class="kpi-value" id="kpi-total-sessions">-</span>
        </div>
        <div class="card kpi-card">
          <span class="kpi-title">Active Users</span>
          <span class="kpi-value" id="kpi-active-users">-</span>
        </div>
        <div class="card kpi-card">
          <span class="kpi-title">Avg Session Duration</span>
          <span class="kpi-value" id="kpi-avg-session">-</span>
        </div>
        <div class="card kpi-card highlight">
          <span class="kpi-title">Highest Score User</span>
          <span class="kpi-value" id="kpi-top-score-user">-</span>
          <span class="kpi-sub" id="kpi-top-score-value">Score: 0</span>
        </div>
      </section>

      <!-- Charts Row -->
      <section class="charts-row">
        <div class="card chart-card">
          <div class="section-title">Top 10 Users by Score</div>
          <div class="chart-wrapper">
            <canvas id="topScoreChart"></canvas>
          </div>
        </div>
        <div class="card chart-card">
          <div class="section-title">Activity Over Time</div>
          <div class="chart-wrapper">
            <canvas id="activityTimeChart"></canvas>
          </div>
        </div>
      </section>

      <!-- Top 5 Highlight Panels -->
      <section class="highlights-grid">
        <div class="card highlight-panel">
          <div class="panel-header">üèÜ Top 5 by Score</div>
          <ul id="top5-score" class="highlight-list"></ul>
        </div>
        <div class="card highlight-panel">
          <div class="panel-header">‚è±Ô∏è Top 5 by Connected Minutes</div>
          <ul id="top5-minutes" class="highlight-list"></ul>
        </div>
        <div class="card highlight-panel">
          <div class="panel-header">üîÅ Top 5 by Session Count</div>
          <ul id="top5-sessions" class="highlight-list"></ul>
        </div>
        <div class="card highlight-panel">
          <div class="panel-header">üë• Top 5 by Avg Followers</div>
          <ul id="top5-followers" class="highlight-list"></ul>
        </div>
      </section>

    </div>

    <!-- ==================== TAB 2: RANKINGS ==================== -->
    <div id="tab-rankings" class="tab-content">

      <!-- Ranking Mode Toggle -->
      <section class="ranking-controls">
        <label>Rank By:</label>
        <select id="rankingMode">
          <option value="score">Score</option>
          <option value="minutes">Time Connected</option>
          <option value="sessions">Sessions</option>
          <option value="avgFollowers">Avg Followers</option>
          <option value="maxFollowers">Max Followers</option>
        </select>
      </section>

      <!-- Master Ranking Table -->
      <section class="table-container">
        <div class="table-header">Master Ranking Table</div>
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th class="sortable" data-sort="nickname">Nickname ‚Üï</th>
              <th class="sortable" data-sort="minutes">Minutes ‚Üï</th>
              <th class="sortable" data-sort="sessions">Sessions ‚Üï</th>
              <th class="sortable" data-sort="avgFollowers">Avg Followers ‚Üï</th>
              <th class="sortable" data-sort="maxFollowers">Max Followers ‚Üï</th>
              <th class="sortable" data-sort="score">Score ‚Üï</th>
              <th>First Seen</th>
              <th>Last Seen</th>
            </tr>
          </thead>
          <tbody id="rankingBody"></tbody>
        </table>
      </section>

      <!-- Distribution Charts -->
      <section class="charts-row">
        <div class="card chart-card">
          <div class="section-title">Session Duration Distribution</div>
          <div class="chart-wrapper">
            <canvas id="sessionDistChart"></canvas>
          </div>
        </div>
        <div class="card chart-card">
          <div class="section-title">Followers Distribution</div>
          <div class="chart-wrapper">
            <canvas id="followersDistChart"></canvas>
          </div>
        </div>
      </section>

    </div>

    <!-- ==================== TAB 3: USER ACTIVITY ==================== -->
    <div id="tab-user-activity" class="tab-content">

      <!-- User Selector -->
      <section class="user-selector card">
        <label>Select User:</label>
        <input type="text" id="userSearch" placeholder="Search by nickname..." list="userList">
        <datalist id="userList"></datalist>
        <a id="userProfileLink" href="#" target="_blank" class="profile-link" style="display:none;">View Profile</a>
      </section>

      <!-- User Summary Card -->
      <section id="userSummary" class="user-summary card" style="display:none;">
        <div class="summary-header">
          <h3 id="selectedUserName">-</h3>
        </div>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-label">Total Time</span>
            <span class="stat-value" id="user-total-minutes">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Sessions</span>
            <span class="stat-value" id="user-sessions">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Session Length</span>
            <span class="stat-value" id="user-avg-session">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Followers</span>
            <span class="stat-value" id="user-avg-followers">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Max Followers</span>
            <span class="stat-value" id="user-max-followers">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Consistency Score</span>
            <span class="stat-value" id="user-consistency">-</span>
          </div>
        </div>
      </section>

      <!-- User Charts -->
      <section id="userCharts" class="charts-row" style="display:none;">
        <div class="card chart-card">
          <div class="section-title">Connected Minutes Over Time</div>
          <div class="chart-wrapper">
            <canvas id="userMinutesChart"></canvas>
          </div>
        </div>
        <div class="card chart-card">
          <div class="section-title">Followers While Live</div>
          <div class="chart-wrapper">
            <canvas id="userFollowersChart"></canvas>
          </div>
        </div>
      </section>

      <!-- Sessions Timeline -->
      <section id="userTimeline" class="card" style="display:none;">
        <div class="section-title">Session Activity Timeline</div>
        <div id="sessionTimeline" class="timeline-strip"></div>
      </section>

      <!-- Session Details Table -->
      <section id="userSessionDetails" class="table-container" style="display:none;">
        <div class="table-header">Session Details</div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody id="sessionDetailsBody"></tbody>
        </table>
      </section>

    </div>

    <!-- ==================== TAB 4: SESSIONS & TIME ==================== -->
    <div id="tab-sessions" class="tab-content">

      <!-- Session Length Distribution -->
      <section class="card chart-card-full">
        <div class="section-title">Session Length Distribution</div>
        <div class="chart-wrapper-full">
          <canvas id="sessionLengthHist"></canvas>
        </div>
      </section>

      <!-- Time-of-Day Heatmap -->
      <section class="card">
        <div class="section-title">Time-of-Day Heatmap (Activity by Hour)</div>
        <div id="heatmapContainer" class="heatmap-container">
          <canvas id="heatmapChart"></canvas>
        </div>
      </section>

      <!-- Session Reliability Matrix -->
      <section class="card">
        <div class="section-title">Session Reliability Matrix (Users vs Days)</div>
        <div id="reliabilityMatrix" class="matrix-container"></div>
      </section>

    </div>

    <!-- ==================== TAB 5: INSIGHTS & ANOMALIES ==================== -->
    <div id="tab-insights" class="tab-content">

      <!-- Automatic Insights -->
      <section class="insights-grid">
        <div class="card insight-panel">
          <div class="insight-icon">üìà</div>
          <div class="insight-title">Highest Follower Spike</div>
          <div class="insight-content" id="insight-follower-spike">-</div>
        </div>
        <div class="card insight-panel">
          <div class="insight-icon">‚è∞</div>
          <div class="insight-title">Longest Continuous Presence</div>
          <div class="insight-content" id="insight-longest-presence">-</div>
        </div>
        <div class="card insight-panel">
          <div class="insight-icon">üîÑ</div>
          <div class="insight-title">Most Consistent Streamer</div>
          <div class="insight-content" id="insight-most-consistent">-</div>
        </div>
        <div class="card insight-panel">
          <div class="insight-icon">‚ö°</div>
          <div class="insight-title">Highest Activity Burst</div>
          <div class="insight-content" id="insight-activity-burst">-</div>
        </div>
      </section>

      <!-- Opportunity Signals -->
      <section class="card">
        <div class="section-title">Opportunity Signals</div>
        <div class="opportunities-grid">
          <div class="opportunity-panel">
            <div class="opportunity-header">üå± Growth Opportunity</div>
            <div class="opportunity-desc">High followers + Low time = Potential for growth</div>
            <ul id="growth-opportunities" class="opportunity-list"></ul>
          </div>
          <div class="opportunity-panel">
            <div class="opportunity-header">üì¢ Exposure Inefficiency</div>
            <div class="opportunity-desc">High time + Low followers = Needs better reach</div>
            <ul id="exposure-issues" class="opportunity-list"></ul>
          </div>
        </div>
      </section>

      <!-- Anomaly Detection -->
      <section class="card">
        <div class="section-title">Anomaly Detection</div>
        <div id="anomalies-list" class="anomalies-container">
          <p class="text-muted">Analyzing data for anomalies...</p>
        </div>
      </section>

    </div>

  </main>

  <script type="module" src="../src/app.js"></script>
</body>

</html>